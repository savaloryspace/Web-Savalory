<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Savalory Ordering System</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial, sans-serif;}
body{background:#f4f4f9;padding:20px;}
h2{margin:15px 0;}
.container{display:flex;gap:20px;}
.card{background:#fff;padding:15px;border-radius:10px;box-shadow:0 0 5px rgba(0,0,0,0.2);}
#menu{flex:2;}
#cart{flex:1;}
input,select,button{padding:8px;margin:4px 0;width:100%;}
button{cursor:pointer;border:none;border-radius:6px;background:#007bff;color:white;font-weight:bold;}
button:hover{opacity:.8;}
.menu-item{padding:10px;margin:8px 0;border-radius:8px;background:#fafafa;border:1px solid #ddd;}
.cart-item{padding:10px;margin:8px 0;border-radius:8px;background:#fff8e1;border:1px solid #ffc107;}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.badge{background:red;color:#fff;border-radius:50%;padding:4px 8px;font-size:12px;}
</style>
</head>

<body>

<div class="header">
  <h1>Savalory Ordering System</h1>
  <button id="openCartBtn">Keranjang <span id="cartCount" class="badge">0</span></button>
</div>

<div class="container">
  <div id="menu" class="card">
    <h2>Menu</h2>
    <div id="menuList"></div>
  </div>

  <div id="cart" class="card">
    <h2>Keranjang</h2>
    <div id="cartList"></div>
    <hr>
    <h3>Total: Rp <span id="totalCart">0</span></h3>
    <br>
    <input type="text" id="custName" placeholder="Nama pemesan">
    <input type="text" id="custTable" placeholder="Nomor Meja / Takeaway">
    <input type="text" id="custWA" placeholder="Nomor WhatsApp Admin (628xxxx)">
    <textarea id="custNote" placeholder="Catatan (opsional)"></textarea>
    <br>
    <button id="checkoutBtn">Checkout via WhatsApp</button>
  </div>
</div>

<br><hr><br>

<div class="card">
  <h2>Tambah Menu (Admin)</h2>
  <select id="newCategory">
      <option value="Makanan">Makanan</option>
      <option value="Minuman">Minuman</option>
  </select>

  <input type="text" id="newName" placeholder="Nama Menu">
  <input type="number" id="newPrice" placeholder="Harga">
  <button id="addMenuBtn">Tambah Menu</button>

  <br><br>

  <h3>Diskon (%)</h3>
  <input type="number" id="discount" placeholder="0">
  <button id="saveDiscount">Simpan Diskon</button>
</div>


<script>
// ========================
//  LOCAL STORAGE FUNCTIONS
// ========================
function save(key,data){ localStorage.setItem(key, JSON.stringify(data)); }
function load(key, fallback){ return JSON.parse(localStorage.getItem(key)) || fallback; }

// ===================
//  DATA INITIALIZATION
// ===================
let menu = load('savalory_menu', []);
let cart = load('savalory_cart', []);
let settings = load('savalory_settings', {discount:0});

// ===================
//  RENDER MENU
// ===================
function renderMenu(){
  const menuList = document.getElementById("menuList");
  menuList.innerHTML = "";

  menu.forEach((item,index)=>{
    menuList.innerHTML += `
      <div class="menu-item">
        <b>${item.name}</b> <br>
        Kategori: ${item.category} <br>
        Harga: Rp ${item.price.toLocaleString()}
        <br><br>
        <button onclick="addToCart(${index})">Tambah</button>
      </div>
    `;
  });
}

// ===================
//  ADD MENU (ADMIN)
// ===================
document.getElementById("addMenuBtn").addEventListener('click', ()=>{
  const name = newName.value.trim();
  const category = newCategory.value;
  const price = Number(newPrice.value);

  if(!name || !price){
    alert("Nama & Harga tidak boleh kosong.");
    return;
  }

  menu.push({name,category,price});
  save("savalory_menu", menu);

  newName.value = "";
  newPrice.value = "";

  renderMenu();
});

// ===================
//  CART FUNCTIONS
// ===================
function addToCart(i){
  let item = menu[i];

  let exists = cart.find(x => x.name === item.name);
  if(exists){
    exists.qty++;
  } else {
    cart.push({...item, qty:1});
  }

  save("savalory_cart", cart);
  renderCart();
  renderCartCount();
}

function removeCart(i){
  cart.splice(i,1);
  save("savalory_cart", cart);
  renderCart();
  renderCartCount();
}

function renderCart(){
  const cartList = document.getElementById("cartList");
  cartList.innerHTML = "";

  cart.forEach((item,index)=>{
    cartList.innerHTML += `
      <div class="cart-item">
        <b>${item.name}</b> x ${item.qty}
        <br>Subtotal: Rp ${(item.price * item.qty).toLocaleString()}
        <br><br>
        <button onclick="removeCart(${index})">Hapus</button>
      </div>
    `;
  });

  const subtotal = cart.reduce((s,i)=>s + (i.price*i.qty), 0);
  const disc = Number(settings.discount);
  const total = Math.round(subtotal * (1 - disc/100));

  document.getElementById("totalCart").innerText = total.toLocaleString();
}

function renderCartCount(){
  document.getElementById("cartCount").innerText = cart.length;
}

// ===================
//  SAVE DISCOUNT
// ===================
document.getElementById("saveDiscount").addEventListener("click", ()=>{
  settings.discount = Number(document.getElementById("discount").value);
  save("savalory_settings", settings);
  alert("Diskon disimpan!");
});

// ===================
//  CHECKOUT WHATSAPP
// ===================
document.getElementById('checkoutBtn').addEventListener('click', ()=>{

  if(cart.length === 0){
    alert("Keranjang kosong");
    return;
  }

  const name = custName.value.trim();
  const meja = custTable.value.trim();
  const wa = custWA.value.trim();
  const note = custNote.value.trim();

  if(!name || !meja || !wa){
    alert("Isi Nama, Meja/Takeaway & No WA Admin!");
    return;
  }

  const subtotal = cart.reduce((s,i)=>s + (i.price*i.qty), 0);
  const disc = Number(settings.discount);
  const total = Math.round(subtotal * (1 - disc/100));

  let list = cart.map(i=>`â€¢ ${i.name} x${i.qty} (Rp ${i.price.toLocaleString()})`).join("%0A");

  let msg = `
ðŸ›’ *ORDER BARU*
Nama: ${name}
Meja/Takeaway: ${meja}

${list}

Subtotal: Rp ${subtotal.toLocaleString()}
Diskon: ${disc}%
Total: *Rp ${total.toLocaleString()}*

Catatan: ${note || "-"}
`;

  window.open("https://wa.me/"+wa+"?text="+encodeURIComponent(msg), "_blank");

  cart = [];
  save("savalory_cart", cart);
  renderCart();
  renderCartCount();
});

// ===================
// FIRST LOAD
// ===================
renderMenu();
renderCart();
renderCartCount();
document.getElementById("discount").value = settings.discount;
</script>

</body>
</html>
