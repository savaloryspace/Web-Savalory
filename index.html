<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Savalory â€” Order Food (Single Page)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* ========= GLOBAL STYLE ========= */
:root{ --bg:#f7f7f8; --card:#fff; --text:#222; --muted:#666; --primary:#D44A43; }
[data-theme="dark"]{ --bg:#0f1720; --card:#0b1220; --text:#e6eef8; --muted:#9fb3c8; --primary:#ff6b5b; }

*{box-sizing:border-box}
body{font-family:'Inter',sans-serif;margin:0;background:var(--bg);color:var(--text)}
header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:var(--card);border-bottom:1px solid rgba(0,0,0,0.04);position:sticky;top:0;z-index:80}
.brand{font-weight:700;font-size:18px;display:flex;gap:10px;align-items:center}
.actions{display:flex;gap:10px;align-items:center}
.btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
.btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}
.btn-primary{background:var(--primary);color:#fff}
.icon-btn{background:transparent;border:none;cursor:pointer}

main{padding:20px;max-width:1100px;margin:0 auto}
.hero{display:flex;gap:20px;align-items:center;justify-content:space-between;margin-bottom:18px}
.promo{background:var(--primary);color:#fff;padding:18px;border-radius:12px;min-width:200px;text-align:center}

/* menu */
.filters{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.filter-btn{padding:8px 12px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:var(--card);cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
.card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.04);display:flex;flex-direction:column;gap:10px;position:relative}
.thumb{height:140px;border-radius:10px;object-fit:cover;width:100%}
.add{margin-top:auto;padding:10px;border-radius:8px;background:var(--primary);color:#fff;border:none;cursor:pointer}

/* cart panel */
.cart-panel{position:fixed;right:16px;top:70px;width:420px;max-width:94%;height:calc(100vh - 120px);background:var(--card);border-radius:12px;box-shadow:0 20px 60px rgba(2,6,23,0.2);transform:translateX(110%);transition:transform .35s}
.cart-panel.open{transform:translateX(0)}
.cart-item{display:flex;gap:10px;align-items:center;padding:8px;border-bottom:1px dashed rgba(0,0,0,0.06)}

.checkout-btn{width:100%;padding:12px;border-radius:10px;border:none;background:var(--primary);color:#fff}

/* admin modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:150}
.modal{background:var(--card);padding:16px;border-radius:12px;width:820px;max-width:94%}
.show{display:flex}

.admin-table{width:100%;border-collapse:collapse;margin-top:10px}
.admin-table th,.admin-table td{padding:8px;border-bottom:1px solid rgba(0,0,0,0.06);text-align:left}

@media (max-width:700px){
  .hero{flex-direction:column}
  .cart-panel{width:92%}
}
</style>
</head>

<body>

<header>
  <div class="brand">SAVALORY <span style="font-size:12px;color:var(--muted)">Order Food</span></div>
  <div class="actions">
    <button id="themeToggle" class="btn btn-ghost">ðŸŒ™</button>
    <button id="adminBtn" class="btn btn-ghost">Admin</button>
    <button id="openCart" class="btn btn-ghost">ðŸ›’</button>
    <div id="cartCount" class="cart-badge" style="color:white"></div>
  </div>
</header>


<main>
  <section class="hero">
    <div>
      <h2>Menu Populer</h2>
      <div id="filters" class="filters"></div>
      <div id="menuGrid" class="grid"></div>
    </div>

    <div class="promo">
      <h3 style="margin:0">20% OFF</h3>
      <small>Gunakan diskon dari Admin</small>
    </div>
  </section>

  <!-- CART -->
  <aside id="cartPanel" class="cart-panel">
    <h3>Keranjang</h3>
    <div id="cartList"></div>

    <div style="margin-top:10px">
      <b>Subtotal :</b> <span id="subtotalText">Rp 0</span> <br>
      <b>Diskon :</b> <span id="appliedDiscount">0%</span> <br>
      <h3>Total : <span id="totalText">Rp 0</span></h3>

      <label>Nama</label>
      <input type="text" id="custName">

      <label>No Meja / Takeaway</label>
      <input type="text" id="custTable">

      <label>Nomor WhatsApp Admin</label>
      <input type="text" id="custWA" placeholder="628xxx">

      <label>Catatan (opsional)</label>
      <textarea id="custNote"></textarea>

      <button id="checkoutBtn" class="checkout-btn">Pesan via WhatsApp</button>
      <button id="clearCart" class="btn-ghost" style="width:100%;margin-top:6px">Bersihkan Keranjang</button>
    </div>
  </aside>


  <!-- ADMIN MODAL -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <h3>Admin Panel</h3>
      <button id="closeModal" class="btn-ghost">Close</button>

      <div id="adminLogin">
        <label>Password Admin</label>
        <input type="password" id="adminPassword">
        <button id="doLogin" class="btn-primary">Login</button>
      </div>

      <div id="adminPanel" style="display:none;margin-top:20px">
        <h4>Tambah Menu</h4>

        <input id="newName" placeholder="Nama">
        <input id="newPrice" type="number" placeholder="Harga">

        <!-- âœ… KATEGORI DIGANTI SELECT -->
        <select id="newCat">
          <option value="Makanan">Makanan</option>
          <option value="Minuman">Minuman</option>
        </select>

        <input id="newImg" placeholder="URL gambar">

        <button id="addItem" class="btn-primary" style="margin-top:10px">Tambah Item</button>

        <hr>

        <label>Diskon (%)</label>
        <input type="number" id="globalDiscount" min="0" max="100">
        <button id="saveDiscount" class="btn-ghost">Simpan</button>

        <h4>Daftar Menu</h4>
        <table id="adminList" class="admin-table"></table>

        <button id="exportMenu" class="btn">Export JSON</button>
        <button id="resetDefault" class="btn-ghost">Reset Default</button>
      </div>
    </div>
  </div>
</main>


<script>
/* ==============================
      INITIAL DATA (DEFAULT)
================================ */
const DEFAULT_MENU = [
  { id: genId(), name:"Mie Goreng", price:15000, category:"Makanan", img:"https://images.unsplash.com/photo-1604908177522-04f9a5a1d1d1?auto=format&fit=crop&w=800&q=60" },
  { id: genId(), name:"Nasi Ayam", price:22000, category:"Makanan", img:"https://images.unsplash.com/photo-1604908177578-6d6b1f1c9b1f?auto=format&fit=crop&w=800&q=60" },
  { id: genId(), name:"Es Kopi Susu", price:18000, category:"Minuman", img:"https://images.unsplash.com/photo-1541167760496-1628856ab772?auto=format&fit=crop&w=800&q=60" },
  { id: genId(), name:"Lemon Tea", price:12000, category:"Minuman", img:"https://images.unsplash.com/photo-1562007908-dc7b4b5d9b6a?auto=format&fit=crop&w=800&q=60" }
];

function genId(){ return 'i_'+Math.random().toString(36).slice(2,9) }

let menu = JSON.parse(localStorage.getItem("savalory_menu")) || DEFAULT_MENU;
let cart = JSON.parse(localStorage.getItem("savalory_cart")) || [];
let settings = JSON.parse(localStorage.getItem("savalory_settings")) || {discount:0, adminPass:"savalory123"};


/* ========== THEME ========== */
function applyTheme(){
  document.documentElement.setAttribute("data-theme",
    document.documentElement.getAttribute("data-theme")==="dark" ? "light" : "dark"
  );
}
document.getElementById("themeToggle").onclick = applyTheme;


/* ========== FILTER & MENU RENDER ========== */
function renderFilters(){
  const cats = [...new Set(menu.map(i => i.category))];
  document.getElementById("filters").innerHTML =
    `<button class="filter-btn" onclick="renderMenu()">All</button>` +
    cats.map(c => `<button class="filter-btn" onclick="renderMenu('${c}')">${c}</button>`).join("");
}

function renderMenu(filter=null){
  const list = filter ? menu.filter(m => m.category === filter) : menu;
  const grid = document.getElementById("menuGrid");
  grid.innerHTML = "";

  list.forEach(item => {
    grid.innerHTML += `
      <div class="card">
        <img class="thumb" src="${item.img}">
        <b>${item.name}</b>
        <small>${item.category}</small>
        <b>Rp ${item.price.toLocaleString()}</b>
        <button class="add" onclick="addToCart('${item.id}')">Tambah</button>
      </div>`;
  });
}
renderFilters();
renderMenu();


/* ========== CART ========== */
function addToCart(id){
  const item = menu.find(i => i.id===id);
  const exist = cart.find(i => i.id===id);
  if(exist) exist.qty++;
  else cart.push({...item, qty:1});

  localStorage.setItem("savalory_cart", JSON.stringify(cart));
  renderCart();
}

function renderCart(){
  const c = document.getElementById("cartList");
  c.innerHTML = "";

  if(cart.length===0){ c.innerHTML = "<i>Keranjang kosong</i>"; return;}

  cart.forEach((i,ix)=>{
    c.innerHTML += `
      <div class="cart-item">
        <div>${i.name}<br><small>Rp ${i.price}</small></div>
        <div style="margin-left:auto">
          <button onclick="qty(${ix},-1)">-</button>
          ${i.qty}
          <button onclick="qty(${ix},1)">+</button>
        </div>
      </div>`;
  });

  updateTotal();
}
function qty(i,x){
  cart[i].qty = Math.max(1, cart[i].qty + x);
  localStorage.setItem("savalory_cart", JSON.stringify(cart));
  renderCart();
}

function updateTotal(){
  const subtotal = cart.reduce((a,b)=>a+b.price*b.qty,0);
  const total = Math.round(subtotal - (subtotal * (settings.discount/100)));

  document.getElementById("subtotalText").textContent = "Rp "+subtotal.toLocaleString();
  document.getElementById("totalText").textContent = "Rp "+total.toLocaleString();
  document.getElementById("appliedDiscount").textContent = settings.discount+"%";
}
renderCart();


/* ========== CHECKOUT WA ========== */
document.getElementById("checkoutBtn").onclick = ()=>{
  const wa = document.getElementById("custWA").value;
  const name = document.getElementById("custName").value;
  const meja = document.getElementById("custTable").value;
  const note = document.getElementById("custNote").value;

  let pesan = `Halo Admin, saya ingin pesan:%0A`;
  cart.forEach(i=>{
    pesan += `- ${i.name} x ${i.qty} (Rp ${i.price})%0A`;
  });

  pesan += `%0ATotal: ${document.getElementById("totalText").textContent}`;
  pesan += `%0ANama: ${name}%0AMeja/Takeaway: ${meja}%0ACatatan: ${note}`;

  window.open("https://wa.me/"+wa+"?text="+pesan);
};



/* ========== CLEAR CART ========== */
document.getElementById("clearCart").onclick = ()=>{
  cart = [];
  localStorage.setItem("savalory_cart", JSON.stringify(cart));
  renderCart();
};


/* ========== ADMIN ========== */
document.getElementById("adminBtn").onclick = ()=> document.getElementById("modalBackdrop").classList.add("show");
document.getElementById("closeModal").onclick = ()=> document.getElementById("modalBackdrop").classList.remove("show");

document.getElementById("doLogin").onclick = ()=>{
  if(document.getElementById("adminPassword").value === settings.adminPass){
    document.getElementById("adminLogin").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
    renderAdminList();
  } else alert("Password salah");
};

function renderAdminList(){
  const t = document.getElementById("adminList");
  t.innerHTML = `<tr><th>Nama</th><th>Harga</th><th>Kategori</th><th>Aksi</th></tr>`;
  menu.forEach((m,i)=>{
    t.innerHTML += `
      <tr>
        <td><input value="${m.name}" oninput="menu[${i}].name=this.value"></td>
        <td><input type="number" value="${m.price}" oninput="menu[${i}].price=this.value"></td>
        <td>
          <select onchange="menu[${i}].category=this.value">
            <option ${m.category=='Makanan'?'selected':''}>Makanan</option>
            <option ${m.category=='Minuman'?'selected':''}>Minuman</option>
          </select>
        </td>
        <td><button onclick="del(${i})">Hapus</button></td>
      </tr>`;
  });
}

function del(i){
  menu.splice(i,1);
  saveMenu();
  renderAdminList();
}

document.getElementById("addItem").onclick = ()=>{
  menu.push({
    id: genId(),
    name: newName.value,
    price: Number(newPrice.value),
    category: newCat.value,
    img: newImg.value
  });
  saveMenu();
  renderMenu();
  renderAdminList();
};

document.getElementById("saveDiscount").onclick = ()=>{
  settings.discount = Number(globalDiscount.value);
  localStorage.setItem("savalory_settings",JSON.stringify(settings));
  updateTotal();
};

function saveMenu(){
  localStorage.setItem("savalory_menu", JSON.stringify(menu));
}
document.getElementById("resetDefault").onclick=()=>{
  menu = DEFAULT_MENU;
  saveMenu();
  renderMenu();
  renderAdminList();
};
document.getElementById("exportMenu").onclick = ()=>{
  const blob = new Blob([JSON.stringify(menu,null,2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "menu.json";
  a.click();
};
</script>
</body>
</html>
